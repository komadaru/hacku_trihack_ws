<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8">
        <title>Login Page</title>
        <script src="https://www.gstatic.com/firebasejs/5.8.4/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.8.4/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/5.8.4/firebase-firestore.js"></script>
        <script>
        // Initialize firebase
        let config = {
            apiKey: "AIzaSyDYyZZeuo_5HlgyrHrhyYZUb4n3AaERx9Q",
            authDomain: "project-of-trihack.firebaseapp.com",
            projectId: "project-of-trihack",
            storageBucket: "project-of-trihack.appspot.com",
            messagingSenderId: "559325421489",
            appId: "1:559325421489:web:5f54444d9c28e3de08a790",
            measurementId: "G-H2B94N0G9D"
        };
        try {
            firebase.initializeApp(config);
        } catch(e) {
            console.log(e);
        }

        // submit
        function onSubmit(){
          let currentUser = firebase.auth().currentUser
          if (currentUser === null) {
            document.querySelector("#current-user").textContent = "ログインしていません"
            return false;
          }
          let comName = document.forms[0].elements["com-name"][0]
          let emails = document.forms[0].elements["adding-email"]
          let addingUsers = [];
          for (let email of emails) {
            let addingUser = firebase.auth().getUserByEmail(email)
            if (addingUser !== null) {
              addingUsers.push(addingUser)
          }
          };
          let newCommunity = {
            name: comName,
            users: [currentUser] + addingUsers
          };
          let db = firebase.firestore();
          let col = db.collection("communities");
          col.push(newCommunity);
          console.log("ste")
          return false;
        }
        
        function addEmailInput() {
          let ul = document.querySelector("ul.email-list")
          for (let li of ul.children) {
            console.log(li.children)
            if (li.children[0].value === "") {
              return
            }
          }
          let li = document.createElement("li")
          li.innerHTML = "<input type='email' name='adding-email'>"
          document.querySelector("ul.email-list").appendChild(li)
        }

    </script>
    </head>
    <body>
      <h1>コミュニティ作成</h1>
      <form id="form1" action="return false">
        <p>コミュニティの名前：<input type="text" name="com-name"></p>
        <p>追加するアカウントのメールアドレス：</p>
        <ul class="email-list"><li><input type="email" name="adding-email"></li></ul>
        <button type="button" onclick="addEmailInput()">+別のアドレスを追加</button>
        <input type="submit" onclick="return onSubmit();">
        <p id="current-user"></p>
      </form>
      <script>
      </script>
    </body>
</html>